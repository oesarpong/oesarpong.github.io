<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Fast Robots Student Website</title>
    <meta name="description" content=" add later" />
    <meta name="author" content=" Ethan Sarpong" />
    <!-- Bootstrap icons-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="css/styles.css" rel="stylesheet" />
</head>
<body>
    <!-- Responsive Navbar-->
    <nav class="navbar navbar-expand-lg px-3 bg-dark sticky-top" style=" z-index: 1000; width:100%; height: 3rem;">
        <a class="navbar-brand text-white"> <p class="h4"> <span class="fw-bold "style = "color:tomato;"> MAE 4190 </span> Fast Robots</p> </a>
    </nav>
    <!-- Main Grid Layout -->
    <div class="container-xs px-3 my-3 ">
        <div class="row">
            <!-- Side Column -- About Me + Navigation -->
            <div class="col-12 col-md-3 text-md-center px-4">
                <div class="overflow-y-auto container-md bg-white" style= "max-height: 100%;">
                    <header class ="container d-md-none">  
                        <a><h1 class="text-capitalize"><span class="fw-bold" style="color:tomato;">Welcome!</span></h1>
                        <div class="w-100"></div> <h3 class="fw-bold text-dark text-wrap text-justify"> Student Fast Robots Course Webpage</h3></a>
                    </header>
                    <!-- About Card-->
                    <div class="shadow bg-dark-subtle mx-1 rounded">
                        <div class="card bg-dark py-3 px-3 mx-0 mt-3 align-items-center text-light ">
                            <img src="assets/profile.jpg" class= "img-fluid d-none d-md-block rounded-circle " alt="..."  style = "width: 75%; height: 75%;">
                            <img src="assets/profile.jpg" class= "img-fluid d-md-none rounded-circle " alt="..."  style = "width: 50%; height: 50%;">
                            <h3 class="card-title fw-bolder text-center my-2 px-3"> Ethan Sarpong</h3>
                            <h6 class="card-title text-center px-3" style="color: rgb(173, 173, 173);"> Mechanical Engineer | eos29</h6>
                            <ul class="nav nav-underline">
                                <li class="nav-item justify-content-center">
                                    <div class="d-flex flex-column align-items-center">
                                        <button class="btn px-5 btn-outline-light my-1 fw-medium" type="button" onclick="window.location.href='index.html';">
                                            Homepage
                                        </button>       
                                        <button class="btn px-2 my-1 mx-3 btn-outline-light fw-medium" type="button" onclick="window.location.href='lab1.html';">
                                            Lab 1: Artemis & Bluetooth
                                        </button> 
                                        <button class="btn px-4 my-1 mx-3 btn-outline-light fw-medium" type="button" onclick="window.location.href='lab2.html';">
                                            Lab 2: IMU Sensor
                                        </button> 
                                        <button class="btn px-4 my-1 mx-3 btn-outline-light fw-medium" type="button" onclick="window.location.href='lab3.html';">
                                            Lab 3: ToF Sensor
                                        </button> 
                                        <button class="btn px-2 my-1 mx-3 btn-outline-light fw-medium" type="button" onclick="window.location.href='lab4.html';">
                                            Lab 4: Motors and Open Loop Control
                                        </button> 
                                        <button class="btn px-2 my-1 mx-3 btn-outline-light fw-medium" type="button" onclick="window.location.href='lab5.html';">
                                            Lab 5: PID Control/Interpolation
                                        </button> 
                                        <button class="btn px-2 my-1 mx-3 btn-outline-light fw-medium" type="button" onclick="window.location.href='lab6.html';">
                                            Lab 6: Orientation Control
                                        </button> 
                                        <button class="btn px-2 my-1 mx-3 btn-outline-light fw-medium" type="button" onclick="window.location.href='lab7.html';">
                                            Lab 7: Kalman Filtering
                                        </button> 
                                        <button class="btn px-2 my-1 mx-3 btn-outline-light fw-medium" type="button" onclick="window.location.href='lab8.html';">
                                            Lab 8: Stunts
                                        </button> 
                                        <button class="btn px-2 my-1 mx-3 btn-outline-light fw-medium" type="button" onclick="window.location.href='lab9.html';">
                                            Lab 9: Mapping
                                        </button> 
                                        <button class="btn px-2 my-1 mx-3 btn-outline-light fw-medium" type="button" onclick="window.location.href='lab10.html';">
                                            Lab 10: Grid Localization I
                                        </button> 
                                        <button class="btn px-2 my-1 mx-3 btn-outline-light fw-medium" type="button" onclick="window.location.href='lab11.html';">
                                            Lab 11: Grid Localization II
                                        </button> 
                                        <button class="btn px-2 my-1 mx-3 btn-outline-light fw-medium" type="button" onclick="window.location.href='lab12.html';">
                                            Lab 12: Planning & Execution
                                        </button> 
                                    </div>
                                </li>
                            </ul>
                            <footer class="pt-1 pb-2 my-3">
                                <div class="container">
                                    <h3 class=""><span class="fw-bold" style="color:tomato;">Contact Information<span></h3>
                                    <p class="fw-medium">Email: <span class="fw-light">eos29@cornell.edu</span></p>
                                    <p class="fw-medium lh-1">LinkedIn: <small><a class="link-opacity-10-hover" href="https://www.linkedin.com/in/ethan-sarpon/">https://www.linkedin.com/in/ethan-sarpon/</a></small></p>
                                </div> 
                            </footer> 
                        </div>
                    </div>
                </div>
            </div>  
            <!-- Main Column -- Page Content -->
            <div class="col-12 col-md-9 bg-white overflow-y-scroll px-5 " style="height: 155vh;">
                <div class="d-flex flex-column ms-2 text-darkt">
                    <h1 class="text-capitalize fw-bolder mt-3">
                        <span class="fw-bolder" style="color:tomato; font-size: clamp(2.5rem, 2vw, 2.5rem);">Lab 6: Orientation PID</span>
                    </h1>
                    <h2 class="fw-bolder mt-5">Greetings from South Africa!</h2> <hr style="margin-top: 0;">
                    <div class="row">
                        <div class="col-12 d-flex justify-content-center">
                            <img class="img-fluid align-self-center w-50" src="assets/lab6/92ccf1ec-178d-4b0d-8f2d-24db2959db63.JPG" alt="...">
                        </div>
                    </div>
                    <h2 class="fw-bolder mt-5">Introduction</h2> <hr style="margin-top: 0;">
                    <p class="fw-light">
                      The purpose of this lab is to continue gaining experience with PID Controllers. In this lab, we aim to control the orientation of the robot using the IMU sensor. The main focus will be on stationary (in place)
                      orientation control.
                    </p>
                    <h2 class="fw-bolder mt-5">Prelab - Data Processing</h2> <hr style="margin-top: 0;">
                    <p class="fw-light">
                        To begin the lab, I established a method for sending and receiving data and commands in order to send control inputs and debug the robot from my labtop. Similar to the previous lab, I set up several 
                        arrays to record the relevant data I wanted to monitor on my laptop. Only a few iterations were made to accomadate a new type of controller. See code below.
                    </p>
                    <div class="my-4 px-5 mx-5 align-self-center" style="max-height: 40vh; overflow-y: auto; border: 1px solid rgb(41, 40, 40); padding: 10px;">
                        <script src="https://gist.github.com/oesarpong/297b6a5918c64a2850bb43ab5b71e549.js"></script>                    
                    </div>
                    <h5 class="fw-bold mt-3">IMU Configuring</h5> 
                    <p class="fw-light">
                        The input variable we will be using to control the orientation of the robot is the <span class="fw-medium fst-italic">Yaw</span> of the robot. This variable can be 
                        measured using the gyroscope on the IMU sensor, but there are a few limitation with direction intgration the sensor data to calculate an estimate for orientation.
                    </p>
                    <h6 class="fw-bolder text-decoration-underline text-center mt-2">IMU Limitations</h6>
                    <div class="fw-light mb-1">
                        <p class="text-center">- Bias: Rate of Error Propagation</p>
                        <p class="text-center">- Sampling Rate/Frequency</p>
                    </div>
                    <p class="fw-light">
                        To accomdate these limitations, I decided to use the onboard <span class="fw-bold">Digital Motion Processor (DMP)</span> built into the IMU. The DMP fuses the readings from the IMU's gyroscope, accelerometer,
                        and magnetometer. 
                    </p>
                    <h6 class="fw-bolder text-decoration-underline text-center mt-2">Advantages of Using DMP</h6>
                    <div class="fw-light mb-1 ">
                        <p class="text-center">- Error & Drift Correction</p>
                        <p class="text-center">- Transforms Axes using Rotation Matrix</p>
                        <p class="text-center">- Capable of Adjusting Initial ODR Rate of 55hz</p>
                    </div>
                    <p class="fw-light mt-2">
                        Using the example code as a guide, I implemented the intialization DMP and created a built in function, 
                        <span class="fst-italic fw-medium" style="color: tomato;">yawDMP()</span>.
                        that would use this processor to calculate the yaw. The <span class="fw-medium">DMP automatically corrects the bias of the sensor after a couple of seconds</span>. Therefore, in the setup
                        I added a delay in order to ensure the sensor was calibrated before continuing. Additionally, I slowed the frequency of which it loads the FIFO (in other words stores data) to about 35 Hz, so that it doesn't crash from having a full que. The choice of 35 hz is based on the speed of my controller. 
                    </p>
                    <div class="my-4 px-5 mx-5 align-self-center" style="max-height: 40vh; overflow-y: auto; border: 1px solid rgb(41, 40, 40); padding: 10px;">
                        <script src="https://gist.github.com/oesarpong/d06367b7db565ea86961009421c594e0.js"></script>
                    </div>
                    <div class="d-flex justify-content-center my-3">
                        <iframe width="560" height="315" src="https://www.youtube.com/embed/_LJeUw5U-Z4?si=EL_0dvWELS3iogOn" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
                    </div>
                    <h2 class="fw-bold mt-3">Implementation</h2> <hr style="margin-top: 0;">
                    <p class="fw-light">
                        Now ready to implement this controller, I started by creating a new command 
                        <span class="fst-italic fw-bold" style="color: tomato;">ORI_CONTROLLER</span> to tell the robot to reach the setpoint using the provided gain values. A notable feature of this 
                        command is the <span class="fw-medium">consideration of the Yaw's Output Range being between [-180 180]</span>. The target value is therefore <span class="fw-medium">normalized to the robots interpreted orientation</span> 
                        which will singificantly assist with the error measurement of the PID controller. 
                    </p>
                    <div class="my-4 px-5 mx-5 align-self-center" style="max-height: 40vh; overflow-y: auto; border: 1px solid rgb(41, 40, 40); padding: 10px;">
                        <script src="https://gist.github.com/oesarpong/9ec0e97d98bedc385eee7c0ad1f7a46b.js"></script>
                    </div>
                    <p class="fw-light">
                        This control infromation is plugged straight into 
                        <span class="fst-italic fw-medium" style="color: tomato;">pidController()</span> which is used to operate only the orientation of the car. This controller is very similar to the positional controller, but 
                        is updated to constantly store new data in the main loop.
                    </p>
                    <div class="my-4 px-5 mx-5 align-self-center" style="max-height: 40vh; overflow-y: auto; border: 1px solid rgb(41, 40, 40); padding: 10px;">
                        <script src="https://gist.github.com/oesarpong/cbaf419ad871734264b6b5e998dc8051.js"></script>                    
                    </div>
                    <h5 class="fw-bold mt-3">Deadband Debugging</h5> 
                    <p class="fw-light">
                        While debugging there was an issue regaring the deadband region prior to the robot actually turning about it's axis. Because the <span class="fw-medium">motors had different damping</span>, one of the motos tends to overcome losses sooner and starts spinning before the other motor. This would 
                        <span class="fw-medium">cause the car to roll forward instead of spinning as intended</span>. To account for this I created a new scaling function, 
                        <span class="fst-italic fw-bold" style="color: tomato;">c.scale_a()</span>, which resolved this issue by having the car brake within the deadband region. 
                    </p>
                    <div class="my-4 px-5 mx-5 align-self-center" style="max-height: 40vh; overflow-y: auto; border: 1px solid rgb(41, 40, 40); padding: 10px;">
                        <script src="https://gist.github.com/oesarpong/7d56f991cd7bec00cd4c60acf283e56e.js"></script>                    
                    </div>
                    <h2 class="fw-bold mt-3">Stationary Orientation Control</h2> <hr style="margin-top: 0;">
                    <p class="fw-light">
                        Now I wanted to begin to set up a controller to maintain its intial orientation even when pushed out of place. Referring to the program code above, I began creating a new controller using my previous knowledge of PID Gains from Lab 5.
                    </p>
                    <div class="card fw-light px-3 py-3 ms-3">
                        <h6 class="fw-bold card-title">PID Controller</h6><hr style="margin-top: 0;">
                        <p><span class="fw-medium">Proportional</span>: Directly Affects Controller Speed, Proportional to Error</p>
                        <p><span class="fw-medium">Integral</span>: Integrates Error Overtime, Affects Steady State Error</p>
                        <p><span class="fw-medium">Derivative</span>: Takes Deriavtive of Error, Senstitive to Change, Noisy, Affects Overshoot</p>
                    </div>
                    <h6 class="fw-bolder text-decoration-underline text-center mt-5">High Level Goals/Expectations</h6>
                    <div class="fw-light">
                        <p class="text-center">- Minimal Overshoot; Acceptable</p>
                        <p class="text-center">- < 1% Steady State Error</p>
                        <p class="text-center">- Repeatablility</p>
                    </div>
                    <h5 class="fw-bold mt-3">P Controller</h5> 
                    <p class="fw-light">
                        Interested in the initial response of the system, I started off with a Proportional Controller. I selected an intiial Kp value by looking at the ratio between largest magnitudes between the input and output (255 PWM/360 Degrees). This resulted in a Kp equal to 0.71. 
                        After trying this out, I realized that the robot did not respond as fast as I liked so I increased the proportional gain to <span class="fw-medium">Kp = 1.3</span>. Below are the results. 
                    </p>
                    <h6 class="fw-bold mt-3">System Response</h6> 
                    <div class="d-flex justify-content-center my-3">
                        <iframe width="560" height="315" src="https://www.youtube.com/embed/DJViITr3HWI?si=hlvJFe3ZO_3yvaB_" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>                    
                    </div>
                    <div class="d-flex justify-content-center mt-5">
                        <img class="img-fluid align-self-center" src="assets/lab6/ORI_P_Controller_PWM.png" alt="...">
                    </div>
                    <div class="d-flex justify-content-center mt-5">
                        <img class="img-fluid align-self-center" src="assets/lab6/ORI_P_Controller_ANGLE.png" alt="...">
                    </div>
                    <h6 class="fw-bold mt-3">Discussion</h6> 
                    <p class="fw-light">
                        The P controller performed very well. There is an overshoot of about 30 degrees and a steady state error of about 5 deg. 
                        Now with an idea of how the system will respond, I added some integral and derivative gains to respond to this. 
                    </p>
                    <h5 class="fw-bold mt-3">PID Controller</h5> 
                    <p class="fw-light">
                        Familiar with PID gains, I decided to jump straight into a full PID controller. After some considerations, I decided that the <span class="fw-medium">underlining priority of this controller is to reach the setpoint</span>. 
                        I'd like to eliminate as much error as possible, and an <span class="fw-medium">small overshoot along the way is acceptable</span> for this controller. Unlike the positional controller, I don't have an issue of potentially hitting a wall and breaking my 
                        robot. The only <span class="fw-medium">cost for this is time</span>, which I am willing to spare. Therefore, I tweaked the gains until I reached an acceptable response.
                    </p>
                    <h6 class="fw-bold mt-3">System Response</h6> 
                    <div class="d-flex justify-content-center my-3">
                        <iframe width="560" height="315" src="https://www.youtube.com/embed/gh4fRbzxVTA?si=AbBl7OBGJTLsYXcN" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>                    
                    </div>
                    <div class="d-flex justify-content-center mt-5">
                        <img class="img-fluid align-self-center" src="assets/lab6/ORI_PID_Controller_ANGLE.png" alt="...">
                    </div>
                    <div class="d-flex justify-content-center mt-5">
                        <img class="img-fluid align-self-center" src="assets/lab6/ORI_PID_Controller_PWM.png" alt="...">
                    </div>
                    <h2 class="fw-bold mt-3">Step Response Orientation Control</h2> <hr style="margin-top: 0;">
                    <p class="fw-light">
                        After accomplishing stationary controls, I was eager to implement a step response that would change the robots orientation on command. I imagine this to be useful in future lab where we execute localization and planning of a path. 
                        In order to do this, I would need a large step response to overcome the static friction which was previous eliminated by an external interferance. Therefore, I decided that for an 
                        error greater then 45% degrees I wanted to be running at max speed to meet the setpoint. In the end, I was looking for a snappy response to the target with a similar response as the above controller. Below are the results. 
                    </p>
                    <div class="d-flex justify-content-center">
                        <iframe width="560" height="315" src="https://www.youtube.com/embed/EpdiXwFcD3w?si=TlQjQz1MmByQSu1o" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
                    </div>
                    <div class="d-flex justify-content-center mt-5">
                        <img class="img-fluid align-self-center" src="assets/lab6/ORI_SET__PID_Controller_PWM.png" alt="...">
                    </div>
                    <div class="d-flex justify-content-center mt-5">
                        <img class="img-fluid align-self-center" src="assets/lab6/ORI_SET_PID_Controller_ANGLE.png" alt="...">
                    </div>
                    <h2 class="fw-bold mt-5">Sampling Rate Discussion</h2> <hr style="margin-top: 0;">
                    <p class="fw-light">
                        An notable point of delay for this controller is processing/computing time including that spent managing the elements of data arrays. Using pointers significantly assisted with decreasing my sampling time. Below is a histogram showing the distrubtion of sampling rates recieved by my laptop from the artemis. 
                        The <span class="fw-medium">average frequency for this controller was about 13.5 ms</span> .
                    </p>
                    <div class="d-flex justify-content-center mt-5">
                        <img class="img-fluid align-self-center w-50" src="assets/lab6/ORI_CONTROLLER_HIST.png" alt="...">
                    </div>
 
                    
                    <h2 class="fw-bolder mt-5">References</h2> <hr style="margin-top: 0;">
                    <div class="fw-light">
                        <p>
                            <span class="fw-medium fst-italic">ChatGPT:</span> Served as valuable resource for programming in C and html. This AI did not serve to be useful for developing logic and algorithim.
                            Rather it was used for finding function documentation and aquiring knowledge for unknown built-in functions. This was useful when searching for documentation and configuration of the hardware.
                        </p>
                        <p>
                            <span class="fw-medium fst-italic">2024 Student Webpages: </span>Referenced as guides and inspiration in developing my own controller. 
                            Variety served to be useful as this was an open ended lab. Additionally, it helped troubleshoot by having accounts for similar errors.
                        </p>
                        <ul class="ms-2 list-group-flush">
                            <li class="list-group-item">1. Kaiyuan Xu Webpage</li>
                            <li class="list-group-item">2. Nila Narayan</li>
                        </ul>
                        <p>
                            <span class="fw-medium fst-italic">MathWorks: Understanding PID Control </span> - https://www.mathworks.com/videos/series/understanding-pid-control.html
                        </p>
                    </div> 
            </div>


    <!-- Bootstrap core JS-->
        <script src="js/bootstrap.min.js"></script>
    <!-- Core theme JS-->
    <script src="js/scripts.js"></script>
</body>
</html>


